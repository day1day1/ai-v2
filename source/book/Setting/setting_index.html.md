# 设置
用户可在设置页面通过自定义参数获取想要的数据，包括自定义参数、自定义事务、自定义远程服务、应用设置、自定义调用栈五部分。

![](/images/set_10.png)

##1. 自定义参数

自定义参数页面用于定义web事务trace中上传的参数数据，OneAPM AI按照集群进行分类，在每个集群下面，用户可自定义名称、定义不同类型上传规则，下面以java探针为例，它支持http和method类型。 
![](/images/set_11.png)  

**HTTP类型**  
当用户选择类型为http时，用户可设置http请求参数，包括URL、session id、默认用户特征参数、参数提取规则、适用的web事务。
![](/images/set_12.png)    

用户可自定义参数提取规则，AI支持的提取范围包括cookie、request header、request parameter、session，key则根据用户自己业务代码进行定义。  
![](/images/set_13.png)   

在设定好参数提取规则后，可选择适用的web事务，对该web事务进行trace追踪。
![](/images/set_14.png)   

**Method类型**  
用户可自定义方法签名，参数过滤条件、指定收集的参数、适用的web事务等。
![](/images/set_15.png)   

##2. 自定义事务
自定义事务页面用于灵活设置web事务的数据拆分和聚合规则。选择对应的集群，点击添加，即可进入到自定义事务配置页面，页面由设置名称、业务匹配范围、请求梳理拆分业务共三部分组成，其中优先级是不必须要填写的，当一个集群配置多个自定义事务时，一个URL符合多个配置的自定义事务，系统将按照优先级进行查找与显示。  
OneAPM AI的自定义事务设置视探针而有所不同，以Java探针为例，它支持Servlet、POJO类型事务提取。  
**Servlet类型**
![](/images/set_0301.png)  
业务匹配范围是对监控的事务进行描述，由请求方法、URL、HTTP 参数、Header 参数、请求主机地址、请求主机端口 6 部分组成，用户可根据自身业务情况进行自定义。
当在业务匹配范围选择了URL后，在右侧可使用请求数据拆分业务。  
使用请求数据拆分业务是对左半部分（业务匹配范围）匹配出来的 Web 事务进行如何展示。
   * 使用请求数据拆分业务，由 从开头的第几段来拆分事务、尾部的第几段来拆分、中间的第几段来拆分 3 部分组成。
   * HTTP 参数拆分事务，是问号之后的参数进行拆分事务，例如一个 URL 是

    ``` 
    www.xxx.com/aaa/bbb/ccc?ddd=eee&fff=ggg
    ```
    当用 ddd 来拆分事务，展示出来的就是


    ``` 
    aaa/bbb/ccc/eee
    ```
   * 使用 Header 参数来拆分事务，例如

    ``` 
    www.xxx.com/aaa/bbb/ccc?ddd=eee&fff=ggg
    ```
    Connection 是 Keep-alive，用 Connection 来进行拆分事务，展示出来就是

    ``` 
    aaa/bbb/ccc/keep-alive
    ```
   * 按照请求方式拆分事务，根据配置规则来进行展示，当配置规则是 POST 就会展示出 POST。
   * 按照请求主机地址来拆分事务，会根据请求的主机地址来展示。
   * 请求来源主机地址拆分事务，就是用户访问的主机来展示。


**POJO类型**  
![](/images/set_21.png) 

##3. 自定义远程服务
用户可在此版块灵活设置远程服务的数据拆分和聚合规则。 选择要配的集群后点击添加，进入到自定义远程服务。使用请求数据拆分业务的使用方法可参见自定义事务模块方法。
![](/images/set_0401.png)

##4.应用设置
应用设置板块主要用于设置探针上传数据的相关阈值和参数，One APM AI以整个应用的框架向用户进行呈现，用户可对应用下的每个集群进行设置。
![](/images/set_05.png)

在应用设置页面,OneAPM AI分为基本信息、慢事务、浏览器监控、Web 事务、HTTP 请求参数、错误信息、数据库、过滤指定事务这 8 个部分。

**基本信息**   
用于修改当前应用的展示名称。
![](/images/set_051.png)

**慢事务**

* 修改慢事务追踪的阈值。当事务的响应时间超过阈值,则开始记录“慢事务追踪”(默认为 4 倍 Apdex T)
* 修改 Agent 最多能够传回的慢事务的个数(默认为 20 个,最小为 1)
* 修改性能指数 Apdex T。(默认为 0.5 秒)
![](/images/set_052.png)

**浏览器监控**

通过勾选或者取消勾选,可以启用或者停用浏览器监控。
![](/images/set_053.png)

**Web 事务**

* 勾选“自动命名 Web 事务”,则会根据应用框架和组件来命名 Web 事务;若不勾选,则使用 
Web 事务的 URI 来命名 Web 事务。
* 在过滤静态资源栏,可以用逗号分隔,填写多个赋值内容。则会自动过滤以上格式的静态文件,避免生成过多的事务。
![](/images/set_054.png)

**HTTP 请求参数**

* 勾选“采集 HTTP 请求参数”,则会捕捉 HTTP 参数,并将它展示在慢追踪和错误信息中。
* 忽略参数:在忽略参数行,填写需要忽略的参数,并使用逗号分隔。则会有选择的放弃收集这些 HTTP 参数。
若用户既需要看到某些重要的 HTTP 参数,但同时也要保护敏感信息。则可以使用该部分功能实现。
![](/images/set_055.png)

**错误信息**

* 勾选“采集错误信息”,则将采集该应用所有的错误和异常信息。
* 在过滤类名栏,可以用逗号分隔,填写多个赋值内容。则会过滤掉这些特定的类名,不作为错误信息报告。
![](/images/set_056.png)

**数据库**

* 勾选“启用慢 SQL 追踪”,则会捕捉运行缓慢的 SQL 语句。<br><br>
* 追踪模式:通过下拉列表,修改 SQL 的追踪模式 ——“关闭”表示不记录 SQL;“原始 SQL” 表示按原模式纪录 SQL;“混淆 SQL 表示不纪录数字和字符串。<br><br>
* 勾选“执行计划追踪”,则会捕捉执行计划。(目前只支持 MySQL 和 PostgreSQL 的 Select 语句)<br><br>
* 慢 SQL 追踪阈值:该选项只有在“启用慢 SQL 追踪”时才生效。当 SQL 的执行时间大于该阈值的时候,将其记录为慢 SQL;如果开启“执行计划追踪”,同时也会收集该 SQL 的执行计划。(默认值为 0.5 秒)<br><br>
* Stacktrace 阈值:作用于 Web 事务的 Trace 功能和慢 SQL 追踪功能,当某组件的响应时间超过该阈值,则收集并展示 Stacktrace。(默认值为 0.5 秒)
![](/images/set_057.png)

**过滤指定事务**

![](/images/set_058.png)
对指定的过滤事务进行修改
![](/images/set_059.png)

##5.自定义调用栈
在调用栈模块，用户可以将调用栈加入黑名单或白名单，其中黑名单主要是用于过滤掉一些不重要的方法和类，降低调用栈的可读性和系统开销。白名单主要是用于在过滤掉的类中显示一些特殊方法。
![](/images/set_22.png)
